"use strict";$(document).ready(function(){var t=$("body");$(document).on({ajaxStart:function(){t.addClass("loading")},ajaxStop:function(){t.removeClass("loading")}});var n=$("#cartId").val(),e=$("#totalPrice"),i=$("#errorMsg"),a=$(".submitBtn1"),o=$("#submitBtn2"),s={id:"",total_quantity:1,total_price:0,total_unit_price_excluding_tax:0,total_tax_amount:0,method:""};if(window.location.pathname==="/ajanvaraus/"+n){var d=function(){$.get("/ajanvaraus/"+n+"/tarkista_palvelut",function(t){return 0<t.items.length?(i.html(""),a.removeClass("btn-disabled")):(i.html('\n            <div class="ui info message">\n              <i class="close icon"></i>\n              <div class="header">\n                Huom!\n              </div>\n              <ul class="list">\n                <li>Valitse vähintään yksi palvelu jatkaaksesi.</li>\n             </ul>\n          </div>\n        '),a.addClass("btn-disabled"))})};d();var r=$("#selectedServices");$(".datarow").on("click",".checkbox2",function(t){t.stopPropagation(),s.id=$(this).attr("id"),s.method="add",s.total_price=$(this).attr("total_price"),s.total_tax_amount=$(this).attr("total_tax_amount"),s.total_unit_price_excluding_tax=$(this).attr("total_unit_price_excluding_tax"),""!==s.id&&0<s.total_price&&0<s.total_tax_amount&&0<s.total_unit_price_excluding_tax&&$.ajax({url:"/ajanvaraus/"+n,method:"PATCH",data:s,success:function(t){$("html, body").animate({scrollTop:0},"medium"),"success"===t.message&&(i.html(""),i.html('\n                <div class="ui success message">\n                  <i class="close icon"></i>\n                  <div class="header">\n                    Onnistui! Pelvelu on onnistuneesti lisätty.\n                  </div>\n                  <p>Mikäli olette valinneet haluamanne palvelut, voitte siirtyä varaamaan ajankohtaa.</p>\n                </div>\n              '),e.html(t.cart.total_price_including_tax+",00 €"),r.html(""),t.cart.items.forEach(function(t){r.append('\n                <tr class="service" value="'+t._id+'">\n                  <td>'+t.name+"</td>\n                  <td>"+t.tyre_size+"</td> \n                  <td>"+t.duration+"min</td>\n                  <td>"+(0!==t.discounted_unit_price?t.discounted_unit_price+",00 €":t.unit_price+",00 €")+"</td>\n                  <td>"+t.additional_info+'</td>\n                  <td>\n                    <form class="ui form">\n                      <label class="text-left">\n                        <button type="button" total_price="'+(0===t.discounted_unit_price?t.unit_price:t.discounted_unit_price)+'" total_tax_amount="'+(0===t.discounted_unit_price?t.tax:t.discounted_tax)+'" total_unit_price_excluding_tax="'+(0===t.discounted_unit_price?t.unit_price_excluding_tax:t.discounted_unit_price_excluding_taxes)+'" id="'+t._id+'" class="ui red button removeService"><i class="fa fa-times" aria-hidden="true"></i></button>\n                      </label>\n                    </form>\n                  </td>\n                '),d()}))},error:function(t){i.html('\n            <div class="ui warning message">\n              <i class="close icon"></i>\n              <div class="header">\n                '+t.responseJSON.error+"\n              </div>\n              "+t.responseJSON.message+"\n              Yrittäkää hetken kuluttua uudelleen.\n            </div>\n          ")}})}),$("#selectedServices").on("click",".removeService",function(t){t.stopPropagation(),s.id=$(this).attr("id"),s.method="remove",s.total_price=$(this).attr("total_price"),s.total_tax_amount=$(this).attr("total_tax_amount"),s.total_unit_price_excluding_tax=$(this).attr("total_unit_price_excluding_tax"),""!==s.id&&0<s.total_price&&0<s.total_tax_amount&&0<s.total_unit_price_excluding_tax&&$.ajax({url:"/ajanvaraus/"+n,method:"PATCH",data:s,success:function(t){"success"===t.message&&(i.html('\n                <div class="ui success message">\n                  <i class="close icon"></i>\n                  <div class="header">\n                    Onnistui! Pelvelu on onnistuneesti poistettu.\n                  </div>\n                  <p>Mikäli olette valinneet haluamanne palvelut, voitte siirtyä varaamaan ajankohtaa.</p>\n                </div>\n              '),d(),e.html(t.cart.total_price_including_tax+",00 €"),r.html(""),t.cart.items.forEach(function(t){r.append('\n                  <tr class="service" value="'+t._id+'">\n                    <td>'+t.name+"</td>\n                    <td>"+t.tyre_size+"</td> \n                    <td>"+t.duration+"min</td>\n                    <td>"+(0!==t.discounted_unit_price?t.discounted_unit_price+",00 €":t.unit_price+",00 €")+"</td>\n                    <td>"+t.additional_info+'</td>\n                    <td>\n                      <form class="ui form">\n                        <label class="text-left">\n                          <button type="button" total_price="'+(0===t.discounted_unit_price?t.unit_price:t.discounted_unit_price)+'" total_tax_amount="'+(0===t.discounted_unit_price?t.tax:t.discounted_tax)+'" total_unit_price_excluding_tax="'+(0===t.discounted_unit_price?t.unit_price_excluding_tax:t.discounted_unit_price_excluding_taxes)+'" id="'+t._id+'" class="ui red button removeService"><i class="fa fa-times" aria-hidden="true"></i></button>\n                        </label>\n                      </form>\n                    </td>\n                  </tr>\n                ')}))},error:function(t){i.html('\n            <div class="ui warning message">\n              <i class="close icon"></i>\n              <div class="header">\n                '+err.responseJSON.error+"\n              </div>\n              "+err.responseJSON.message+"\n              Yrittäkää hetken kuluttua uudelleen.\n            </div>\n          ")}})})}if(window.location.pathname==="/ajanvaraus/"+n+"/ajankohta"){var l,c=function(){$.get("/ajanvaraus/"+n+"/tarkista_ajat",function(t){return t.length?($("#selectedTime").show(500),o.prop("disabled",!1),o.removeClass("btn-disabled")):($("#selectedTime").hide(500),o.prop("disabled",!0),o.addClass("btn-disabled"))})},u=function(t,e,n){return n(t.filter(function(t){if(t.time.split(":")[0]===e)return t}))};$('[data-toggle="datepicker"]').datepicker({autoHide:!0,startDate:moment(Date.now()).format("DD/MM/YYYY"),zIndex:2048,inline:!0,format:"dd.MM.YYYY",language:"fi-FI",filter:function(t,e){if(0===t.getDay()&&"day"===e)return!1}}),c();$("#td08"),$("#td09"),$("#td10"),$("#td11"),$("#td12"),$("#td13"),$("#td14"),$("#td15"),$("#td16"),$("#td17");var m=$(".timesTd"),_=$("#selectedTime"),p=$("#message");l=new Date,"Aikoja päivälle "+moment(l).format("DD.MM.YYYY"),$('[data-toggle="datepicker"]').on("change",function(){var t=$('[data-toggle="datepicker"]').datepicker("getDate",!0);$.ajax({url:"/ajanvaraus/"+n+"/ajankohta?day="+function(t){var e=t.split(".");return e[2]+"-"+e[1]+"-"+e[0]}(t),type:"GET",success:function(t,e,n){m.html("");for(var i,a,o,s=8,d=$("#warningHeading");s<18;)u(t.times,s<10?"0"+String(s):String(s),function(t){t.forEach(function(t){i=moment(t.day).format("DD/MM/YYYY"),i=new Date(i),a=moment(Date.now()).format("DD/MM/YYYY"),a=new Date(a),o=moment(t.day).format("dd/MM/YYYY").split("/")[0],"Sa"===moment(t.day).format("dd/MM/YYYY").split("/")[0]?d.show(600):d.hide(500),$(s<10?"#td0"+String(s):"#td"+String(s)).append('\n<form class="time-box '+(t.taken?"red-td-bg":"Sa"===o||i<=a&&100*parseFloat(t.time.split(":").join(".")).toFixed(2)<100*parseFloat(moment(Date.now()).format("HH.mm")).toFixed(2)?"gray-td-bg":"green-td-bg")+'" time_id="'+t._id+'" id="'+t._id+'" hour="'+t.time+'" day="'+t.day+'">\n                    <input type="hidden" name="id" value="'+t._id+'">\n                    <p>'+t.time+"</p>\n                    <p>"+t.quantity+"/1</p>\n                  </form>\n                ")})}),s++},error:function(t){p.html(""),p.html('\n<div class="ui warning message">\n<i class="close icon"></i>\n<div class="header">\n'+err.responseJSON.error+"\n</div>\n"+err.responseJSON.message+"\nYrittäkää hetken kuluttua uudelleen.\n</div>\n")}})});var h=[],g=1;$("#times").on("mouseover",".time-box",function(t){$("#confModal");t.stopPropagation();var e={id:$(this).attr("time_id"),duration:$("#duration").val(),hour:$(this).attr("")};0<g&&$.ajax({url:"/ajanvaraus/"+n+"/kesto",method:"PATCH",data:e,global:!1,success:function(t){var e=t.filter(function(t){return!1===t.taken});if(h=[],g=0,$(".time-box").removeClass("red2-td-bg"),$(".time-box").removeClass("dark_green-td-bg"),e.length<t.length)for(var n=0;n<t.length;n++)$("#"+t[n]._id).addClass("red2-td-bg");else for(n=0;n<t.length;n++)$("#"+t[n]._id).addClass("dark_green-td-bg"),h.push(t[n]._id)},error:function(){g=1}})}),$("#times").on("mouseleave",".time-box",function(t){t.stopPropagation(),g=1});var v=$(".serviceSection"),f=(_=$("#selectedTime"),$("#selectedTimesTable")),x=$("#timeSelectionInput"),b=$("#timeSelectionTable");$("#times").on("click",".time-box",function(t){t.stopPropagation(),$(".time-box").css("pointer-events","none"),$("#time-suggestion").html(""),$("#time-suggestion").html(moment($(this).attr("day")).locale("fi").format("DD.MM.YYYY")+", alkaen klo: "+$(this).attr("hour")),$("#confModal").modal("show"),$("#acceptTime").on("click",function(){h.length&&$.ajax({url:"/ajanvaraus/"+n+"/ajankohta",method:"PUT",data:h,success:function(t){p.html('\n<div class="ui success message">\n<i class="close icon"></i>\n<div class="header">\nOnnistui! Aika on onnistuneesti lisätty.\n</div>\n<p>Mikäli olette päättänet haluamanne ajan, voitte siirtyä täyttämään henkilötietonne.</p>\n</div>\n'),_.show(200),f.html("\n<tr>\n<td>"+moment(t[0].day).format("DD.MM.YYYY")+"</td>\n<td>alkaen klo "+t[0].time+"</td>\n</tr>\n"),$("#confModal").modal("hide"),$(".time-box").css("pointer-events","auto"),b.toggleClass("hidden"),v.toggleClass("hidden"),x.toggleClass("hidden"),$("#submitBtn2").prop("disabled",!1),$("html, body").animate({scrollTop:0},"medium"),c()},error:function(t){$(".time-box").css("pointer-events","auto"),p.html(""),p.html('\n<div class="ui warning message">\n<i class="close icon"></i>\n<div class="header">\n'+t.responseJSON.error+"\n                  </div>\n                  "+t.responseJSON.message+"\n                </div>\n              ")}})}),$("#cancelTime").on("click",function(){t.stopPropagation(),$(".time-box").css("pointer-events","auto"),$("#confModal").modal("hide")})}),$("#changeTime").on("click",function(){x.toggleClass("hidden"),b.toggleClass("hidden"),v.toggleClass("hidden")})}$("#errorMsg").on("click",".close",function(){$(this).parent().hide()}),$("#message").on("click",".close",function(){$(this).parent().hide()})});