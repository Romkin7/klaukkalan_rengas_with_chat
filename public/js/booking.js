$(document).ready(function(){var t=$("#cartId").val(),e=$("#totalPrice"),i=$("#errorMsg"),n=$("#submitBtn1"),a=$("#submitBtn2"),s={id:"",total_quantity:1,total_price:0,total_unit_price_excluding_tax:0,total_tax_amount:0,method:""};function c(){$.get(`/ajanvaraus/${t}/tarkista`,function(t){return t.items.length>0?n.removeClass("btn-disabled"):n.addClass("btn-disabled")})}function l(){$.get(`/ajanvaraus/${t}/tarkista`,function(t){return t.time?a.removeClass("btn-disabled"):a.addClass("btn-disabled")})}c(),l();var o,r=$("#selectedServices");$(".bookingService").on("click",".tyretypeBtn",function(){var e="/ajanvaraus/"+t+"/"+$(this).closest(".bookingService").attr("value"),i={category:$(this).closest(".bookingService").attr("value"),tyre_size:$(this).attr("value")};$.getJSON(e.toLowerCase(),i).done(t=>{$("#datarow").html(""),t.services.forEach(function(t){$("#datarow").append(`\n          <tr class="service" value="${t._id}">\n            <td>${t.name}</td>\n            <td>${0===t.tyre_size?'16" ja alle / 17"':16===t.tyre_size?t.tyre_size+" ja alle":t.tyre_size+" ja yli"}</td> \n            <td>${0!==t.discounted_unit_price?t.discounted_unit_price+",00 €":t.unit_price+",00 €"}</td>\n            <td>${t.additional_info}</td>\n            <td>\n              <div class="checkbox">\n                <label class="text-left" style="font-size: 18px">\n                  <input type="checkbox" total_price="${0===t.discounted_unit_price?t.unit_price:t.discounted_unit_price}" total_tax_amount="${0===t.discounted_unit_price?t.tax:t.discounted_tax}" total_unit_price_excluding_tax="${0===t.discounted_unit_price?t.unit_price_excluding_tax:t.discounted_unit_price_excluding_taxes}" id="${t._id}" class="checkbox2">\n                  <span class="cr"><i class="cr-icon fa fa-check"></i></span>\n                </label>\n              </div>\n            </td>\n          </tr>\n          `)})}).fail(t=>{console.log(t)})}),$("#datarow").on("click",".checkbox2",function(n){n.stopPropagation(),console.log(this),s.id=$(this).attr("id"),s.method="add",s.total_price=$(this).attr("total_price"),s.total_tax_amount=$(this).attr("total_tax_amount"),s.total_unit_price_excluding_tax=$(this).attr("total_unit_price_excluding_tax"),""!==s.id&&s.total_price>0&&s.total_tax_amount>0&&s.total_unit_price_excluding_tax>0&&$.ajax({url:`/ajanvaraus/${t}`,method:"PATCH",data:s,success:function(t){"success"===t.message&&(i.html('\n              <div class="ui success message">\n                <i class="close icon"></i>\n                <div class="header">\n                  Onnistui! Pelvelu on onnistuneesti lisätty.\n                </div>\n                <p>Mikäli olette valinneet haluamanne palvelut, voitte siirtyä varaamaan ajankohtaa.</p>\n              </div>\n            '),e.html(`${t.cart.total_price_including_tax},00 €`),r.html(""),t.cart.items.forEach(function(t){r.append(`\n                <tr class="service" value="${t._id}">\n                  <td>${t.name}</td>\n                  <td>${0===t.tyre_size?'16" ja alle / 17"':16===t.tyre_size?t.tyre_size+" ja alle":t.tyre_size+" ja yli"}</td> \n                  <td>${0!==t.discounted_unit_price?t.discounted_unit_price+",00 €":t.unit_price+",00 €"}</td>\n                  <td>${t.additional_info}</td>\n                  <td>\n                    <form class="ui form">\n                      <label class="text-left">\n                        <button type="button" total_price="${0===t.discounted_unit_price?t.unit_price:t.discounted_unit_price}" total_tax_amount="${0===t.discounted_unit_price?t.tax:t.discounted_tax}" total_unit_price_excluding_tax="${0===t.discounted_unit_price?t.unit_price_excluding_tax:t.discounted_unit_price_excluding_taxes}" id="${t._id}" class="ui red button removeService"><i class="fa fa-times" aria-hidden="true"></i></button>\n                      </label>\n                    </form>\n                  </td>\n              `),c()}))},error:function(t){console.log(t),i.html(`\n           <div class="ui warning message">\n            <i class="close icon"></i>\n            <div class="header">\n              ${t.responseJSON.error}\n            </div>\n            ${t.responseJSON.message}\n            Yrittäkää hetken kuluttua uudelleen.\n          </div>\n          `)}})}),$("#selectedServices").on("click",".removeService",function(n){n.stopPropagation(),s.id=$(this).attr("id"),s.method="remove",s.total_price=$(this).attr("total_price"),s.total_tax_amount=$(this).attr("total_tax_amount"),s.total_unit_price_excluding_tax=$(this).attr("total_unit_price_excluding_tax"),""!==s.id&&s.total_price>0&&s.total_tax_amount>0&&s.total_unit_price_excluding_tax>0&&$.ajax({url:`/ajanvaraus/${t}`,method:"PATCH",data:s,success:function(t){"success"===t.message&&(i.html('\n              <div class="ui success message">\n                <i class="close icon"></i>\n                <div class="header">\n                  Onnistui! Pelvelu on onnistuneesti poistettu.\n                </div>\n                <p>Mikäli olette valinneet haluamanne palvelut, voitte siirtyä varaamaan ajankohtaa.</p>\n              </div>\n            '),c(),e.html(`${t.cart.total_price_including_tax},00 €`),r.html(""),t.cart.items.forEach(function(t){r.append(`\n                <tr class="service" value="${t._id}">\n                  <td>${t.name}</td>\n                  <td>${0===t.tyre_size?'16" ja alle / 17"':16===t.tyre_size?t.tyre_size+" ja alle":t.tyre_size+" ja yli"}</td> \n                  <td>${0!==t.discounted_unit_price?t.discounted_unit_price+",00 €":t.unit_price+",00 €"}</td>\n                  <td>${t.additional_info}</td>\n                    <td>\n                    <form class="ui form">\n                      <label class="text-left">\n                        <button type="button" total_price="${0===t.discounted_unit_price?t.unit_price:t.discounted_unit_price}" total_tax_amount="${0===t.discounted_unit_price?t.tax:t.discounted_tax}" total_unit_price_excluding_tax="${0===t.discounted_unit_price?t.unit_price_excluding_tax:t.discounted_unit_price_excluding_taxes}" id="${t._id}" class="ui red button removeService"><i class="fa fa-times" aria-hidden="true"></i></button>\n                      </label>\n                    </form>\n                  </td>\n                </tr>\n              `)}))},error:function(t){i.html(`\n           <div class="ui warning message">\n            <i class="close icon"></i>\n            <div class="header">\n              ${err.responseJSON.error}\n            </div>\n            ${err.responseJSON.message}\n            Yrittäkää hetken kuluttua uudelleen.\n          </div>\n        `)}})});var d,u=$("#day"),_=$("#times"),p=$("#selectedTime"),m=$("#message");o=new Date,d=`Aikoja päivälle ${moment(o).format("DD.MM.YYYY")}`,u.html(d),$("#calendar").on("click","td",function(){var e,i;o=$(this).attr("id"),d=o.split("_")[3],u.html(""),u.html(`Aikoja päivälle ${e=d,i=e.split("-"),`${i[2]}.${i[1]}.${i[0]}`}`),$.ajax({url:`/ajanvaraus/${t}/ajankohta?day=${d}`,type:"GET",data:d,success:function(t){_.html(""),t.times.forEach(function(t){_.append(`\n              <tr time_id="${t._id}" class="${!0===t.taken?"notSelectable":"selectTime"}">\n                <td>${t.time}</td>\n                <td class="${!0===t.taken?"negative":"positive"}">${!0===t.taken?"varattu":"vapaa"}</td>\n              </tr>\n            `),l()})},error:function(t){m.html(""),m.html(`\n            <div class="ui warning message">\n              <i class="close icon"></i>\n              <div class="header">\n                ${err.responseJSON.error}\n              </div>\n              ${err.responseJSON.message}\n              Yrittäkää hetken kuluttua uudelleen.\n            </div>\n          `)}})}),$("#calendar").zabuto_calendar({year:o.getFullYear(),month:o.getMonth()+1,show_previous:!1,show_next:2,today:!0,cell_border:!0,show_days:!0,weekstartson:1,nav_icon:{prev:'<i class="fa fa-chevron-circle-left"></i>',next:'<i class="fa fa-chevron-circle-right"></i>'},legend:[{type:"text",label:"Vapaita aikoja",badge:"00"},{type:"block",label:"Paljon aikoja",classname:"green"},{type:"spacer"},{type:"text",label:"Ei vapaita aikoja"},{type:"list",list:["grade-1","grade-2","grade-3","grade-4"]},{type:"text",label:"Hyvä"}]}),$("#times").on("click",".selectTime",function(e){e.stopPropagation();var i={id:$(this).attr("time_id")};""!==i&&$.ajax({url:`/ajanvaraus/${t}/ajankohta`,method:"PATCH",data:i,success:function(t){console.log(t),_.html(""),m.html('\n            <div class="ui success message">\n              <i class="close icon"></i>\n              <div class="header">\n                Onnistui! Aika on onnistuneesti lisätty.\n              </div>\n              <p>Mikäli olette päättänet haluamanne ajan, voitte siirtyä täyttämään henkilötietonne.</p>\n            </div>\n          '),p.html(""),p.html(`\n            <thead class="tablet desktop">\n              <tr>\n                <th>Valittu Päivä</th>\n                <th>Valittu Aika</th>\n              </tr>\n            </thead>\n            <tbody id="times">\n              <tr>\n                <td>${moment(t.cart.time.day).format("DD.MM.YYYY")}</td>\n                <td>${t.cart.time.time}</td>\n              </tr>\n            </tbody>\n          `),l()},error:function(t){m.html(""),m.html(`\n            <div class="ui warning message">\n              <i class="close icon"></i>\n              <div class="header">\n                ${t.responseJSON.error}\n              </div>\n              ${t.responseJSON.message}\n            </div>\n          `)}})}),$("#errorMsg").on("click",".close",function(){$(this).parent().hide()}),$("#message").on("click",".close",function(){$(this).parent().hide()})});